<!DOCTYPE html>
<html>
<head>
    <title>WebSocket 测试</title>
</head>
<body>
    <h1>WebSocket 连接测试</h1>
    <div id="status">状态: 未连接</div>
    <div id="log"></div>
    
    <script>
        const log = document.getElementById('log');
        const status = document.getElementById('status');
        
        function addLog(message) {
            const p = document.createElement('p');
            p.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            log.appendChild(p);
            console.log(message);
        }
        
        addLog('开始连接 WebSocket...');
        
        try {
            const ws = new WebSocket('ws://localhost:8000/ws/test');
            
            ws.onopen = () => {
                addLog('✅ WebSocket 连接成功！');
                status.textContent = '状态: 已连接';
                status.style.color = 'green';
                
                // 发送测试消息
                ws.send(JSON.stringify({ type: 'ping' }));
                addLog('发送 ping 消息');
            };
            
            ws.onmessage = (event) => {
                addLog('收到消息: ' + event.data);
            };
            
            ws.onerror = (error) => {
                addLog('❌ WebSocket 错误: ' + error);
                status.textContent = '状态: 错误';
                status.style.color = 'red';
            };
            
            ws.onclose = (event) => {
                addLog('WebSocket 连接关闭: code=' + event.code + ', reason=' + event.reason);
                status.textContent = '状态: 已关闭';
                status.style.color = 'orange';
            };
        } catch (error) {
            addLog('❌ 创建 WebSocket 失败: ' + error);
        }
    </script>
</body>
</html>

